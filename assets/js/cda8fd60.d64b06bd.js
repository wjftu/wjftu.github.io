"use strict";(self.webpackChunkwjftu_ds=self.webpackChunkwjftu_ds||[]).push([[877],{3362:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"docker/dockerfile","title":"Dockerfile \u6784\u5efa\u955c\u50cf","description":"\u5982\u679c\u4f7f\u7528 docker commit \u6765\u63d0\u4ea4\u548c\u5206\u4eab\u955c\u50cf\uff0c\u522b\u4eba\u53ea\u80fd\u901a\u8fc7 registry \u6216\u5176\u5b83\u65b9\u5f0f\u5bfc\u5165\u955c\u50cf\uff0c\u4e0d\u4ec5\u4e0d\u65b9\u4fbf\uff0c\u800c\u4e14\u4e0d\u77e5\u9053\u955c\u50cf\u5982\u4f55\u5236\u4f5c\uff0c\u53ef\u80fd\u6709\u4e0d\u5b89\u5168\u56e0\u7d20\u3002\u800c\u901a\u8fc7 Dockerfile \u6784\u5efa\u955c\u50cf\uff0c\u53ea\u9700\u5206\u4eab Dockerfile \u5373\u53ef\u5206\u4eab\u955c\u50cf\uff0c\u522b\u4eba\u53ef\u4ee5\u6839\u636e Dockerfile \u6784\u5efa\u4e00\u4e2a\u4e00\u6837\u7684\u955c\u50cf\u3002","source":"@site/note/docker/dockerfile.md","sourceDirName":"docker","slug":"/docker/dockerfile","permalink":"/note/docker/dockerfile","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Dockerfile \u6784\u5efa\u955c\u50cf","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"\u5bb9\u5668","permalink":"/note/docker/container"},"next":{"title":"\u7f51\u7edc","permalink":"/note/docker/network"}}');var r=i(4848),c=i(8453);const d={title:"Dockerfile \u6784\u5efa\u955c\u50cf",sidebar_position:5},s=void 0,o={},t=[{value:"Dockerfile \u6307\u4ee4",id:"dockerfile-\u6307\u4ee4",level:3},{value:"FROM",id:"from",level:4},{value:"LABEL",id:"label",level:4},{value:"WORKDIR",id:"workdir",level:4},{value:"ADD",id:"add",level:4},{value:"ENV",id:"env",level:4},{value:"RUN",id:"run",level:4},{value:"CMD",id:"cmd",level:4},{value:"ENTRYPOINT",id:"entrypoint",level:4},{value:"Dockerhub",id:"dockerhub",level:3},{value:"\u6784\u5efa\u955c\u50cf\u5b9e\u4f8b",id:"\u6784\u5efa\u955c\u50cf\u5b9e\u4f8b",level:3}];function a(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f7f\u7528 docker commit \u6765\u63d0\u4ea4\u548c\u5206\u4eab\u955c\u50cf\uff0c\u522b\u4eba\u53ea\u80fd\u901a\u8fc7 registry \u6216\u5176\u5b83\u65b9\u5f0f\u5bfc\u5165\u955c\u50cf\uff0c\u4e0d\u4ec5\u4e0d\u65b9\u4fbf\uff0c\u800c\u4e14\u4e0d\u77e5\u9053\u955c\u50cf\u5982\u4f55\u5236\u4f5c\uff0c\u53ef\u80fd\u6709\u4e0d\u5b89\u5168\u56e0\u7d20\u3002\u800c\u901a\u8fc7 Dockerfile \u6784\u5efa\u955c\u50cf\uff0c\u53ea\u9700\u5206\u4eab Dockerfile \u5373\u53ef\u5206\u4eab\u955c\u50cf\uff0c\u522b\u4eba\u53ef\u4ee5\u6839\u636e Dockerfile \u6784\u5efa\u4e00\u4e2a\u4e00\u6837\u7684\u955c\u50cf\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"dockerfile-\u6307\u4ee4",children:"Dockerfile \u6307\u4ee4"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u5e38\u5c06 Dockerfile \u6587\u4ef6\u547d\u540d\u4e3a ",(0,r.jsx)(n.code,{children:"Dockerfile"}),"\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u540d\u5b57\uff0c\u4f46\u6784\u5efa\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a Dockerfile \u6587\u4ef6\u3002\u6307\u4ee4\u901a\u5e38\u5199\u4e3a\u5927\u5199\uff0c\u867d\u7136\u5c0f\u5199\u4e5f\u53ef\u4ee5\u4f7f\u7528\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"from",children:"FROM"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9a\u4e49 base image"}),"\n",(0,r.jsx)(n.p,{children:"\u4e3a\u4e86\u5b89\u5168\u3002\u5c3d\u91cf\u4f7f\u7528\u5b98\u65b9 base image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"FROM scratch\nFROM centos\nFROM Ubuntu:20.04\n"})}),"\n",(0,r.jsx)(n.h4,{id:"label",children:"LABEL"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9a\u4e49 metadata \uff0c\u7c7b\u4f3c\u6ce8\u91ca"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'LABEL maintainer="wjf@email.com"\nLABEL version="1.0"\nLABEL description="xx" \n'})}),"\n",(0,r.jsx)(n.h4,{id:"workdir",children:"WORKDIR"}),"\n",(0,r.jsxs)(n.p,{children:["\u8bbe\u5b9a\u5f53\u524d\u76ee\u5f55\uff0c\u7c7b\u4f3c cd \uff0c\u5982\u679c\u4e0d\u5b58\u5728\u4f1a\u81ea\u52a8\u521b\u5efa\u3002\u5c3d\u91cf\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"WORKDIR"})," \uff0c\u4e0d\u8981\u7528 ",(0,r.jsx)(n.code,{children:"RUN cd"})," \uff0c\u5c3d\u91cf\u7528\u7edd\u5bf9\u76ee\u5f55"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"WORKDIR /root\n"})}),"\n",(0,r.jsx)(n.h4,{id:"add",children:"ADD"}),"\n",(0,r.jsx)(n.p,{children:"\u590d\u5236\u6587\u4ef6\uff0c\u5982\u679c\u662f\u538b\u7f29\u6587\u4ef6\u4f1a\u81ea\u52a8\u89e3\u538b\u7f29"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# \u590d\u5236 hello \u5230\u6839\u76ee\u5f55\nADD hello /\n# \u538b\u7f29\u6587\u4ef6\u4f1a\u88ab\u89e3\u538b\u7f29\nADD test.tar.gz /\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u4f1a\u662f WORKDIR \u7684\u76f8\u5bf9\u8def\u5f84"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"WORKDIR /root\nADD hello test/\n# /root/test/hello\n"})}),"\n",(0,r.jsx)(n.h4,{id:"env",children:"ENV"}),"\n",(0,r.jsxs)(n.p,{children:["\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3001\u5e38\u91cf\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"$"})," \u5f15\u7528"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'ENV MYSEQL_VERSION5.6\nRUN apt install -y mysql-server="${MYSQL_VERSION}" \\\n    && rm -rf /var/lib/apt/lists/*\n'})}),"\n",(0,r.jsx)(n.h4,{id:"run",children:"RUN"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd0\u884c\u547d\u4ee4\u5e76\u521b\u5efa\u65b0\u7684 image layer \u3002\u907f\u514d\u65e0\u7528\u5206\u5c42\uff0c\u5408\u5e76\u591a\u4e2a\u547d\u4ee4\u4e3a\u4e00\u884c\u3002\u5bf9\u4e8e\u590d\u6742\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528\u53cd\u659c\u6760\u6362\u884c\uff0c\u4ee5\u4fbf\u7f8e\u89c2\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"RUN apt update && apt install -y perl \\\nrm -rf  /var/lib/apt/lists/*\n"})}),"\n",(0,r.jsx)(n.h4,{id:"cmd",children:"CMD"}),"\n",(0,r.jsxs)(n.p,{children:["\u8bbe\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\u548c\u53c2\u6570\u3002\u5b9a\u4e49\u591a\u4e2a CMD \uff0c\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u6267\u884c\u3002\u5982\u679c ",(0,r.jsx)(n.code,{children:"docker run"})," \u6307\u5b9a\u4e86\u5176\u5b83\u547d\u4ee4\uff0c CMD \u4f1a\u88ab\u5ffd\u7565\uff0c\u4f8b\u5982 ",(0,r.jsx)(n.code,{children:"docker run -it image_name /bin/bash"})," \uff0c\u5219 CMD \u4e0d\u4f1a\u6267\u884c\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'EXPOSE 27017\nCMD ["mongod"]\n'})}),"\n",(0,r.jsx)(n.h4,{id:"entrypoint",children:"ENTRYPOINT"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u8f83\u591a\u3002\u8bbe\u7f6e\u5bb9\u5668\u542f\u52a8\u65f6\u8fd0\u884c\u7684\u547d\u4ee4\u3002\u8ba9\u5bb9\u5668\u4ee5\u5e94\u7528\u7a0b\u5e8f\u6216\u670d\u52a1\u7684\u5f62\u5f0f\u8fd0\u884c\u3002\u4e0d\u4f1a\u88ab\u5ffd\u7565\u3002\u6700\u4f73\u5b9e\u8df5\uff1a\u5199\u4e00\u4e2a shell \u811a\u672c\u4f5c\u4e3a entrypoint"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'COPY entrypoint.sh /usr/local/bin/\nENTRYPOINT ["entrypoint.sh"]\n'})}),"\n",(0,r.jsx)(n.p,{children:"Shell \u683c\u5f0f\u548c Exec \u683c\u5f0f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Shell \u683c\u5f0f"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'# Shell \nRUN apt install -y vim\nCMD echo "hello"\nENTRYPOINT echo "hi"\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Exec \u683c\u5f0f"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'# Exec\nRUN [ "apt" , "install" , "-y" , "vim"]\nCMD [ "/bin/echo" , "hello" ]\nEMTRYPOINT [ "/bin/echo" , "hi" ]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Shell \u683c\u5f0f\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"$"})," \u5f15\u7528\u53d8\u91cf\uff0c\u800c Exec \u4e0d\u884c\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'FROM centos\nEMV name Jim\n# \u6210\u529f\u8f6c\u4e49\nCMD echo "hello $name"\n# \u4e0d\u6210\u529f\u8f6c\u4e49\nENTRYPOINT ["/bin/echo","hello $name"]\n# \u6210\u529f\u8f6c\u4e49\nENTRYPOINT ["bin/bash","-c","echo hello $name"]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"dockerhub",children:"Dockerhub"}),"\n",(0,r.jsx)(n.p,{children:"\u7c7b\u4f3c GitHub \uff0c\u7528\u6765\u5206\u4eab\u81ea\u5df1\u7684 image \uff0c"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://hub.docker.com",children:"https://hub.docker.com"})}),"\n",(0,r.jsxs)(n.p,{children:["\u547d\u4ee4\u884c\u767b\u5f55 \uff0c ",(0,r.jsx)(n.code,{children:"docker login"})," \uff0c\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u767b\u5f55\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"push \u547d\u4ee4\uff0c\u7c7b\u4f3c git push"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker push [OPTIONS] NAME[:TAG]\ndocker push wjftu/helloworld:latest\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u53d1\u5e03 image \uff0c\u522b\u4eba\u4e0d\u77e5\u9053 image \u662f\u600e\u4e48\u4ea7\u751f\u7684\uff0c\u6709\u6ca1\u6709\u5b89\u5168\u95ee\u9898\uff0c\u56e0\u6b64\u53d1\u5e03 image \u4e0d\u5982\u53d1\u5e03 Dockerfile \uff0c\u53ef\u4ee5\u4f7f\u7528 create -> create automated build \u6765\u4f7f\u7528 GitHub \u6216 Bitbucket \u4ed3\u5e93\u7684 Dockerfile \u6765\u6784\u5efa\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u6784\u5efa\u955c\u50cf\u5b9e\u4f8b",children:"\u6784\u5efa\u955c\u50cf\u5b9e\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'FROM python:3.10\nLABEL maintainer="wjf<wjf@email.com>"\nRUN pip --trusted-host=pypi.python.org --trusted-host=pypi.org --trusted-host=files.pythonhosted.org install flask\nCOPY app.py /app/\nWORKDIR /app\nEXPOSE 5000\nCMD ["python" , "app.py"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528\u547d\u4ee4 ",(0,r.jsx)(n.code,{children:"docker build -t wjftu/hello-flask ."})," \u6784\u5efa\uff0c\u672b\u5c3e\u7684\u70b9\u8868\u793a Dockerfile \u5728\u5f53\u524d\u8def\u5f84\u4e14\u540d\u79f0\u4e3a\u9ed8\u8ba4\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Step 1/7 : FROM python:3.10\n ---\x3e cecf555903c6\nStep 2/7 : LABEL maintainer="wjf<wjf@email.com>"\n ---\x3e Using cache\n ---\x3e 3c18f2523dba\nStep 3/7 : RUN pip --trusted-host=pypi.python.org --trusted-host=pypi.org --trusted-host=files.pythonhosted.org install flask\n ---\x3e Using cache\n ---\x3e 8f9112836ef7\nStep 4/7 : COPY app.py /app/\n ---\x3e 4946666a6b8a\nStep 5/7 : WORKDIR /app\n ---\x3e Running in 0613b3125b62\nRemoving intermediate container 0613b3125b62\n ---\x3e edcbf86421f4\nStep 6/7 : EXPOSE 5000\n ---\x3e Running in 44abba67cf7c\nRemoving intermediate container 44abba67cf7c\n ---\x3e 9ff81a193f1f\nStep 7/7 : CMD ["python" , "app.py"]\n ---\x3e Running in 8f9f0165f09e\nRemoving intermediate container 8f9f0165f09e\n ---\x3e 0070c7e85303\nSuccessfully built 0070c7e85303\nSuccessfully tagged wjftu/hello-flask:latest\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230 build \u7684 image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"root@instance-20210531-1826:~/py# docker images\nREPOSITORY          TAG       IMAGE ID       CREATED          SIZE\nwjftu/hello-flask   latest    0070c7e85303   7 minutes ago    928MB\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u5728 build \u7684\u65f6\u5019\u9047\u5230\u95ee\u9898\uff0c\u53ef\u4ee5\u8fdb\u5165 build \u65f6\u7684\u4e34\u65f6\u5bb9\u5668\u67e5\u770b\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:" ---\x3e 8f9112836ef7\nStep 4/7 : COPY app.py /app\n ---\x3e 727ded8b2327\nStep 5/7 : WORKDIR /app\nCannot mkdir: /app is not a directory\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fdb\u5165\u5bb9\u5668"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -it 727ded8b2327 /bin/bash\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>s});var l=i(6540);const r={},c=l.createContext(r);function d(e){const n=l.useContext(c);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),l.createElement(c.Provider,{value:n},e.children)}}}]);