"use strict";(self.webpackChunkwjftu_ds=self.webpackChunkwjftu_ds||[]).push([[7478],{2516:n=>{n.exports=JSON.parse('{"permalink":"/blog/gh-deploy","source":"@site/blog/2021-12-13-gh-deploy.md","title":"\u4f7f\u7528 GitHub actions \u90e8\u7f72\u6211\u7684\u7f51\u7ad9","description":"\u4f7f\u7528 GitHub actions \u81ea\u52a8\u90e8\u7f72\u6211\u7684\u7f51\u7ad9","date":"2021-12-13T00:00:00.000Z","tags":[{"inline":true,"label":"github","permalink":"/blog/tags/github"},{"inline":true,"label":"CICD","permalink":"/blog/tags/cicd"},{"inline":true,"label":"github actions","permalink":"/blog/tags/github-actions"}],"readingTime":1.52,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u4f7f\u7528 GitHub actions \u90e8\u7f72\u6211\u7684\u7f51\u7ad9","slug":"gh-deploy","tags":["github","CICD","github actions"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528 Vuepress \u5199\u7b14\u8bb0","permalink":"/blog/vuepress"}}')},8453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>c});var t=r(6540);const s={},i=t.createContext(s);function o(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),t.createElement(i.Provider,{value:e},n.children)}},8730:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>u,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>a});var t=r(2516),s=r(4848),i=r(8453);const o={title:"\u4f7f\u7528 GitHub actions \u90e8\u7f72\u6211\u7684\u7f51\u7ad9",slug:"gh-deploy",tags:["github","CICD","github actions"]},c="\u4f7f\u7528 GitHub actions \u90e8\u7f72\u6211\u7684\u7f51\u7ad9",u={authorsImageUrls:[]},a=[];function l(n){const e={a:"a",code:"code",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:"\u4f7f\u7528 GitHub actions \u81ea\u52a8\u90e8\u7f72\u6211\u7684\u7f51\u7ad9"}),"\n",(0,s.jsxs)(e.p,{children:["\u6211\u7684\u7f51\u7ad9\u7531 Vuepress \u548c Docsisy \u642d\u5efa\uff0c\u6839\u76ee\u5f55\u662f Docsify \uff0c\u6bcf\u4e2a\u7b14\u8bb0\u662f Vuepress \u3002\u4e3a\u4e86\u7f16\u8bd1\uff0c\u81ea\u5df1\u505a\u4e86\u4e2a GitHub action \u6765\u7f16\u8bd1\u591a\u4e2a Vuepress \u9879\u76ee \uff1a",(0,s.jsx)(e.a,{href:"https://github.com/wjftu/vuepress_1.x_compiler",children:"https://github.com/wjftu/vuepress_1.x_compiler"})]}),"\n",(0,s.jsx)(e.p,{children:"Dockerfile"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:'FROM node:14-slim\r\n\r\nLABEL "com.github.actions.name"="vuepress1.x_compiler"\r\nLABEL "author"="Jianfeng"\r\n\r\nRUN apt update && yarn global add vuepress && yarn global add @vuepress/plugin-google-analytics\r\n\r\nCOPY entrypoint.sh /entrypoint.sh\r\nENTRYPOINT ["/entrypoint.sh"]\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\r\n\r\nset -e\r\n\r\necho \'\'\r\n\r\n# env\r\necho "node version: $(node -v)"\r\necho "npm version: $(npm -v)"\r\n\r\nif [[ -z "$SOURCE_DIR" ]]; then\r\n  source="/"\r\nelse\r\n  source="$SOURCE_DIR"\r\nfi\r\n\r\nif [[ -z "$BUILD_SCRIPT" ]]; then\r\n  script="yarn && yarn docs:build"\r\nelse\r\n  script="$BUILD_SCRIPT"\r\nfi\r\n\r\n\r\n# Build vuepress project\r\necho "BUILD_SCRIPT: ${script}"\r\necho "github.workspace: ${GITHUB_WORKSPACE}"\r\ndir="${GITHUB_WORKSPACE}/"\r\n\r\n\r\n\r\n\r\necho "npm view: `npm view vuepress`"\r\nfor i in ${source}\r\ndo\r\n  echo `ls`\r\n  cd ${dir}${i}\r\n  echo "start build in : `pwd`"\r\n  eval "${script}"\r\n  echo "${i} Build success"\r\ndone\r\n\r\necho "Build Success!"\r\n\xa9 2022 GitHub, Inc.\r\nTerms\r\nPrivacy\r\n\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u867d\u7136 Github actions market place \u6709\u73b0\u6210\u7684\uff0c\u4f46\u662f\u6ca1\u6709\u591a\u9879\u76ee\u7684\uff0c\u6240\u4ee5\u81ea\u5df1\u5199\u4e86\u4e00\u4e2a\u3002\u5176\u5b9e\u4e0d\u592a\u61c2 node.js \uff0c\u611f\u89c9\u8fd9\u6837\u5199\u53ef\u80fd\u4e0d\u5bf9\uff0c\u6211\u6000\u7591 setup-node \u4e4b\u540e\u76f4\u63a5\u7f16\u8bd1\u5c31\u53ef\u4ee5\uff0c\u4e0d\u8fc7\u8fd9\u4e2a action \u53ef\u4ee5\u7528\u3002"}),"\n",(0,s.jsx)(e.p,{children:".github/workflows/deploy.yml \u6587\u4ef6\u4e2d\u4f7f\u7528\u8fd9\u4e2a action"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yml",children:"name: deploy_to_gh\r\non: [push]\r\njobs:\r\n  build-and-deploy:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n    - name: Checkout\r\n      uses: actions/checkout@v2\r\n    - name: Copy Files\r\n      run: |\r\n        mkdir public \r\n        cp -r home/. public/\r\n    - name: Build\r\n      uses: wjftu/vuepress_1.x_compiler@master\r\n      env:\r\n        SOURCE_DIR: designPattern algorithmPractice\r\n    - name: Deploy\r\n      uses: wjftu/git_push_action@master\r\n      env:\r\n        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}\r\n        TARGET_REPO: wjftu/wjftu.github.io\r\n        TARGET_BRANCH: master\r\n        SOURCE_DIR: public\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6bcf\u6b21 push \u5373\u53ef\u81ea\u52a8\u7f16\u8bd1\u548c\u90e8\u7f72\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u540e\u6765\u4e0d\u7528 Docsify \u548c Vuepress \u4e86\uff0c\u6539\u4e3a Docusaurus \uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u5b98\u65b9\u6587\u6863\u4ecb\u7ecd\u7684 setup-node \u7684 Github actions \u7684\u7f16\u8bd1\u65b9\u6cd5\u4e0d\u80fd\u7528\uff0c\u7136\u540e\u7ee7\u7eed\u7528\u8fd9\u4e2a action"})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}}}]);