"use strict";(self.webpackChunkwjftu_ds=self.webpackChunkwjftu_ds||[]).push([[9943],{6663:e=>{e.exports=JSON.parse('{"permalink":"/blog/clouddrive","source":"@site/blog/2024-03-18-clouddrive.md","title":"\u81ea\u5efa\u7f51\u76d8 Seafile \u548c Cloudreve","description":"\u9700\u8981\u81ea\u5efa\u7f51\u76d8\uff0c\u641c\u7d22\u4e86\u4e00\u4e0b\uff0c\u6709\u5f88\u591a\u6210\u719f\u7684\u4ea7\u54c1 Seafile Cloudreve NextCloud filerun \u7b49\u7b49\u3002\u4ee5\u524d\u53ea\u7528\u8fc7\u73a9\u5177\u7ea7\u522b\u7684 Tiny File Manager \uff0c\u8fd9\u6b21\u8bd5\u4e00\u4e0b\u90e8\u7f72\u6210\u719f\u7684\u4ea7\u54c1\u3002","date":"2024-03-18T00:00:00.000Z","tags":[{"inline":true,"label":"\u7f51\u76d8","permalink":"/blog/tags/\u7f51\u76d8"}],"readingTime":3.27,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"\u81ea\u5efa\u7f51\u76d8 Seafile \u548c Cloudreve","slug":"clouddrive","tags":["\u7f51\u76d8"]},"unlisted":false,"nextItem":{"title":"\u6298\u817e\u4e00\u4e2a\u5907\u6848\u7f51\u7ad9","permalink":"/blog/new-web-site"}}')},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>d});var r=s(6540);const t={},a=r.createContext(t);function o(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:n},e.children)}},8488:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var r=s(6663),t=s(4848),a=s(8453);const o={title:"\u81ea\u5efa\u7f51\u76d8 Seafile \u548c Cloudreve",slug:"clouddrive",tags:["\u7f51\u76d8"]},d=void 0,l={authorsImageUrls:[]},c=[{value:"Seafile",id:"seafile",level:3},{value:"Cloudreve",id:"cloudreve",level:3}];function i(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u9700\u8981\u81ea\u5efa\u7f51\u76d8\uff0c\u641c\u7d22\u4e86\u4e00\u4e0b\uff0c\u6709\u5f88\u591a\u6210\u719f\u7684\u4ea7\u54c1 Seafile Cloudreve NextCloud filerun \u7b49\u7b49\u3002\u4ee5\u524d\u53ea\u7528\u8fc7\u73a9\u5177\u7ea7\u522b\u7684 Tiny File Manager \uff0c\u8fd9\u6b21\u8bd5\u4e00\u4e0b\u90e8\u7f72\u6210\u719f\u7684\u4ea7\u54c1\u3002"}),"\n",(0,t.jsx)(n.p,{children:"Seafile \u548c Cloudreve \u53e3\u7891\u6bd4\u8f83\u597d\uff0c\u5c1d\u8bd5\u7528 docker-compose \u90e8\u7f72\u4f53\u9a8c\u4e00\u4e0b\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"seafile",children:"Seafile"}),"\n",(0,t.jsx)(n.p,{children:"\u540c\u7c7b\u4ea7\u54c1\uff1a Cloudreve Nextcloud"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",children:"services:\n  db:\n    image: mariadb:10.11\n    container_name: seafile-mysql\n    environment:\n      - MYSQL_ROOT_PASSWORD=123456  # Requested, set the root's password of MySQL service.\n      - MYSQL_LOG_CONSOLE=true\n      - MARIADB_AUTO_UPGRADE=1\n    volumes:\n      - /opt/seafile-mysql/db:/var/lib/mysql  # Requested, specifies the path to MySQL data persistent store.\n    networks:\n      - seafile-net\n\n  memcached:\n    image: memcached:1.6.18\n    container_name: seafile-memcached\n    entrypoint: memcached -m 64\n    networks:\n      - seafile-net\n          \n  seafile:\n    image: seafileltd/seafile-mc:latest\n    container_name: seafile\n    ports:\n      - \"8001:80\"\n#     - \"443:443\"  # If https is enabled, cancel the comment.\n    volumes:\n      - /opt/seafile-data:/shared   # Requested, specifies the path to Seafile data persistent store.\n    environment:\n      - DB_HOST=db\n      - DB_ROOT_PASSWD=123456  # Requested, the value should be root's password of MySQL service.\n      - TIME_ZONE=Etc/UTC  # Optional, default is UTC. Should be uncomment and set to your local time zone.\n      - SEAFILE_ADMIN_EMAIL=a@abc.com # Specifies Seafile admin user, default is 'me@example.com'.\n      - SEAFILE_ADMIN_PASSWORD=123123     # Specifies Seafile admin password, default is 'asecret'.\n      - SEAFILE_SERVER_LETSENCRYPT=false   # Whether to use https or not.\n    depends_on:\n      - db\n      - memcached\n    networks:\n      - seafile-net\n\nnetworks:\n  seafile-net:\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4e0a\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u4e86 8001 \u7aef\u53e3\u3002MYSQL_ROOT_PASSWORD \u548c DB_ROOT_PASSWD \u8981\u4e00\u81f4\u3002SEAFILE_ADMIN_EMAIL SEAFILE_ADMIN_PASSWORD \u662f\u7ba1\u7406\u5458\u8d26\u53f7\u548c\u5bc6\u7801\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u542f\u52a8\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker compose up -d\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8bbf\u95ee ",(0,t.jsx)(n.a,{href:"http://ip:8001",children:"http://ip:8001"})," \u5373\u53ef\u770b\u5230\u767b\u5f55\u9875\u9762\uff0c\u4f7f\u7528\u914d\u7f6e\u7684\u7528\u6237\u540d\u53ef\u4ee5\u767b\u5f55"]}),"\n",(0,t.jsx)(n.p,{children:"\u914d\u7f6e caddy \u53cd\u5411\u4ee3\u7406 seafile \uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7 https \u548c\u57df\u540d\u8bbf\u95ee\u4e86"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "apps": {\n      "http": {\n          "http_port": 80,\n          "https_port": 443,\n          "servers": {\n              \n              "srv0": {\n                  "listen": [\n                      ":443"\n                  ],\n                  "routes": [\n                      \n                      {\n                          "match": [\n                              {\n                                  "host": [\n                                      "abc.com"\n                                  ]\n                              }\n                          ],\n                          "handle": [\n                              {\n                                  "handler": "subroute",\n                                  "routes": [\n                                      {\n                                          "handle": [\n                                              {\n                                                  "handler": "reverse_proxy",\n                                                  "headers": {\n                                                      "request": {\n                                                          "set": {\n                                                              "Accept-Encoding": [\n                                                                  "identity"\n                                                              ],\n                                                              "Host": [\n                                                                  "{http.reverse_proxy.upstream.hostport}"\n                                                              ],\n                                                              "X-Forwarded-For": [\n                                                                  "{http.request.remote.host}"\n                                                              ],\n                                                              "X-Forwarded-Port": [\n                                                                  "{http.request.port}"\n                                                              ],\n                                                              "X-Forwarded-Proto": [\n                                                                  "{http.request.scheme}"\n                                                              ],\n                                                              "X-Real-Ip": [\n                                                                  "{http.request.remote.host}"\n                                                              ]\n                                                          }\n                                                      }\n                                                  },\n                                                  "upstreams": [\n                                                      {\n                                                          "dial": "ip:8001"\n                                                      }\n                                                  ]\n                                              }\n                                          ]\n                                      }\n                                  ]\n                              }\n                          ]\n                      }\n                  ]\n              }\n          }\n      }\n  }\n}\n\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u7ecf\u8fc7\u53cd\u5411\u4ee3\u7406\uff0c\u767b\u5f55\u9875\u9762\u53ef\u4ee5\u6253\u5f00\uff0c\u4f46\u767b\u5f55\u540e\u4f1a\u62a5 csrf \u7684\u9519"}),"\n",(0,t.jsxs)(n.p,{children:["\u89e3\u51b3\u65b9\u6cd5\u53c2\u8003\uff1a",(0,t.jsx)(n.a,{href:"https://github.com/haiwen/seafile/issues/2707",children:"https://github.com/haiwen/seafile/issues/2707"})]}),"\n",(0,t.jsx)(n.p,{children:"\u4fee\u6539 seahub_settings.py \uff0cdocker-compose \u7248\u672c\u8def\u5f84\u662f\uff1a /opt/seafile-data/seafile/conf"}),"\n",(0,t.jsx)(n.p,{children:"\u6dfb\u52a0\u4e00\u884c\uff0c\u7136\u540e\u91cd\u65b0\u542f\u52a8\u5373\u53ef\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'CSRF_TRUSTED_ORIGINS = ["https://abc.com"]\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u6b64\u65f6\u53ef\u4ee5\u767b\u5f55\u4e86\uff0c\u4f46\u4e0a\u4f20\u6587\u4ef6\u4ecd\u7136\u62b1\u9519"}),"\n",(0,t.jsxs)(n.p,{children:["\u767b\u5f55\u540e\u8fdb\u5165 ",(0,t.jsx)(n.code,{children:"\u7cfb\u7edf\u7ba1\u7406 - \u8bbe\u7f6e"}),"\uff0c\u8bbe\u7f6e FILE_SERVER_ROOT SERVICE_URL \u4e3a ",(0,t.jsx)(n.a,{href:"https://abc.com",children:"https://abc.com"})," \u548c ",(0,t.jsx)(n.a,{href:"https://abc.com/seafhttp",children:"https://abc.com/seafhttp"})]}),"\n",(0,t.jsx)(n.p,{children:"\u5373\u53ef\u6b63\u5e38\u4f7f\u7528"}),"\n",(0,t.jsx)(n.h3,{id:"cloudreve",children:"Cloudreve"}),"\n",(0,t.jsxs)(n.p,{children:["\u6587\u6863\uff1a",(0,t.jsx)(n.a,{href:"https://docs.cloudreve.org",children:"https://docs.cloudreve.org"})]}),"\n",(0,t.jsx)(n.p,{children:"\u65b0\u5efa\u6587\u4ef6\u5939\u548c\u7a7a\u6587\u4ef6\u3002\u9996\u5148\u8fdb\u5165\u9700\u8981\u90e8\u7f72\u7684\u7684\u6587\u4ef6\u5939\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir -vp cloudreve/{uploads,avatar} \\\n&& touch cloudreve/conf.ini \\\n&& touch cloudreve/cloudreve.db \\\n&& mkdir -p aria2/config \\\n&& mkdir -p data/aria2 \\\n&& chmod -R 777 data/aria2\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5b98\u65b9 docker-compose.yml \uff0c\u53ea\u9700\u4fee\u6539 RPC_SECRET\u3002\u6ce8\u610f docker-compose.yml \u548c\u4e0a\u9762\u5efa\u7684 cloudreve \u5728\u540c\u4e00\u5c42\u76ee\u5f55\uff0c\u800c\u4e0d\u662f\u5728 cloudreve \u91cc\u9762\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",children:'version: "3.8"\nservices:\n  cloudreve:\n    container_name: cloudreve\n    image: cloudreve/cloudreve:latest\n    restart: unless-stopped\n    ports:\n      - "5212:5212"\n    volumes:\n      - temp_data:/data\n      - ./cloudreve/uploads:/cloudreve/uploads\n      - ./cloudreve/conf.ini:/cloudreve/conf.ini\n      - ./cloudreve/cloudreve.db:/cloudreve/cloudreve.db\n      - ./cloudreve/avatar:/cloudreve/avatar\n    depends_on:\n      - aria2\n  aria2:\n    container_name: aria2\n    image: p3terx/aria2-pro\n    restart: unless-stopped\n    environment:\n      - RPC_SECRET=your_aria_rpc_token\n      - RPC_PORT=6800\n    volumes:\n      - ./aria2/config:/config\n      - temp_data:/data\nvolumes:\n  temp_data:\n    driver: local\n    driver_opts:\n      type: none\n      device: $PWD/data\n      o: bind\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u542f\u52a8"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker compose up\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u65e5\u5fd7\u4e2d\u53ef\u4ee5\u770b\u5230\u7528\u6237\u540d\u548c\u5bc6\u7801"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cloudreve  | [Info]    2024-03-18 23:51:45 Admin user name: admin@cloudreve.org\ncloudreve  | [Info]    2024-03-18 23:51:45 Admin password: 43B6S1wb\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8bbf\u95ee ",(0,t.jsx)(n.a,{href:"http://ip:5212",children:"http://ip:5212"})," \u5373\u53ef\u8fdb\u5165"]}),"\n",(0,t.jsx)(n.p,{children:"\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u540c\u4e0a\uff08\u914d\u7f6e\u53cd\u5411\u4ee3\u7406\u524d\u9700\u8981\u5148\u901a\u8fc7 ip \u8bbf\u95ee\uff0c\u8bbe\u7f6e\u57df\u540d\uff09"}),"\n",(0,t.jsx)(n.p,{children:"\u4e24\u8005\u955c\u50cf\u6bd4\u8f83\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"seafileltd/seafile-mc   latest    edc23e02abd9   5 days ago      1.33GB\nmariadb                 10.11     ba6f6d8eea0a   3 weeks ago     404MB\nmemcached               1.6.18    0730201b15c1   12 months ago   89.3MB\ncloudreve/cloudreve     latest    328970d33c60   5 months ago    108MB\np3terx/aria2-pro        latest    997da399fc5d   18 months ago   29.2MB\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4f53\u9a8c\u4e0b\u6765\u611f\u89c9 cloudreve \u754c\u9762\u66f4\u597d\u4e00\u4e9b\uff0c\u800c\u4e14\u66f4\u52a0\u8f7b\u91cf\uff0c\u6700\u7ec8\u9009\u62e9\u4e86 cloudreve"})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(i,{...e})}):i(e)}}}]);