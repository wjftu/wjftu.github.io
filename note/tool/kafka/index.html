<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-note docs-version-current docs-doc-page docs-doc-id-tool/kafka" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Kafka | 健峰的网站</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wjftu.com/note/tool/kafka"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-note-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-note-current"><meta data-rh="true" property="og:title" content="Kafka | 健峰的网站"><meta data-rh="true" name="description" content="Linkedin 开源的消息队列，多集群，可扩展"><meta data-rh="true" property="og:description" content="Linkedin 开源的消息队列，多集群，可扩展"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wjftu.com/note/tool/kafka"><link data-rh="true" rel="alternate" href="https://wjftu.com/note/tool/kafka" hreflang="en"><link data-rh="true" rel="alternate" href="https://wjftu.com/note/tool/kafka" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"开发工具","item":"https://wjftu.com/note/tool/"},{"@type":"ListItem","position":2,"name":"Kafka","item":"https://wjftu.com/note/tool/kafka"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="健峰的网站 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="健峰的网站 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-155045877-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.1b9fda11.css">
<script src="/assets/js/runtime~main.fa7b6039.js" defer="defer"></script>
<script src="/assets/js/main.d6ce1d32.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/note">Note</a><a class="navbar__item navbar__link" href="/life/2023">Life</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/note/tool/">开发工具</a><button aria-label="Collapse sidebar category &#x27;开发工具&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/maven">Maven</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/gradle">Gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/oracle">Oracle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/note/tool/kafka">Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/mongo">Mongo DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/hadoop">Hadoop</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/note/">笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/docker/">Docker</a><button aria-label="Expand sidebar category &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/java/">Java</a><button aria-label="Expand sidebar category &#x27;Java&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/kubernetes/">Kubenetes</a><button aria-label="Expand sidebar category &#x27;Kubenetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/springboot/">Spring Boot</a><button aria-label="Expand sidebar category &#x27;Spring Boot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/designPattern/">设计模式</a><button aria-label="Expand sidebar category &#x27;设计模式&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/algorithmPractice/">算法刷题</a><button aria-label="Expand sidebar category &#x27;算法刷题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/springcloud/">Spring Cloud</a><button aria-label="Expand sidebar category &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/cloud/">云技术</a><button aria-label="Expand sidebar category &#x27;云技术&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/frontend/">前端</a><button aria-label="Expand sidebar category &#x27;前端&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/note/tool/"><span>开发工具</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Kafka</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>kafka</h1></header>
<p>Linkedin 开源的消息队列，多集群，可扩展</p>
<p>官网 <a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">https://kafka.apache.org/</a></p>
<p>下载地址：<a href="https://kafka.apache.org/downloads" target="_blank" rel="noopener noreferrer">https://kafka.apache.org/downloads</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="快速上手">快速上手<a href="#快速上手" class="hash-link" aria-label="Direct link to 快速上手" title="Direct link to 快速上手">​</a></h3>
<p>可直接下载二进制文件运行。当前最新版为 kafka_2.12-3.7.0.tgz 和 kafka_2.13-3.7.0.tgz 。前面的 2.13 是 Scala 的版本号。kafka 用不同版本的 Scala 构建，只有在想用 scala 且希望与 kafka 用相同版本的 scala 才需要关注。</p>
<p>解压缩</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tar -xzf kafka_2.13-3.7.0.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd kafka_2.13-3.7.0</span><br></span></code></pre></div></div>
<p>启动 kafka 。先启动 zookeeper，再启动 kafka server</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Start the ZooKeeper service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bin/zookeeper-server-start.sh config/zookeeper.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start the Kafka broker service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bin/kafka-server-start.sh config/server.properties</span><br></span></code></pre></div></div>
<p>使用 jps 命令可以看到 java 进程</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> % jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2001 Jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1623 Kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1230 QuorumPeerMain</span><br></span></code></pre></div></div>
<p>创建 topic，名字为 quickstart-events</p>
<p>使用 <code>--list</code> 可以查看所有 topic，使用 <code>--describe</code> 可以描述 topic</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mac@MacdeMac-mini kafka_2.13-3.6.1 % bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created topic quickstart-events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mac@MacdeMac-mini kafka_2.13-3.6.1 % bin/kafka-topics.sh --list --bootstrap-server localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quickstart-events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mac@MacdeMac-mini kafka_2.13-3.6.1 % bin/kafka-topics.sh --describe --topic quickstart-events --bootstrap-server localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Topic: quickstart-events	TopicId: dYnjTlTpTqOCUSE4lLFO2g	PartitionCount: 1	ReplicationFactor: 1	Configs: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Topic: quickstart-events	Partition: 0	Leader: 0	Replicas: 0	Isr: 0</span><br></span></code></pre></div></div>
<p>运行 producer 客户端给 topic 创建 event。每一行是一个 event</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">% bin/kafka-console-producer.sh --topic quickstart-events --bootstrap-server localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;This is my first event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;This is my second event</span><br></span></code></pre></div></div>
<p>运行 consumer 客户端消费 event</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">% bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is my first event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is my second event</span><br></span></code></pre></div></div>
<p>删除 topic</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bin/kafka-topics.sh --bootstrap-server localhost:9092 --delete --topic quickstart-events</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a href="#概念" class="hash-link" aria-label="Direct link to 概念" title="Direct link to 概念">​</a></h3>
<p>Producer<br>
<!-- -->对接外部，生产数据</p>
<p>Consumer<br>
<!-- -->消费数据</p>
<p>Topic<br>
<!-- -->消息通过 Topic 分类</p>
<p>Partition<br>
<!-- -->一个 Topic 可以对应多个 Partition 。一个 Partition 的数据只能由一个 Consumer 消费</p>
<p>Broker<br>
<!-- -->每个独立的服务器是一个 broker ，每个 partition 从属于一个 broker ，但可以分配给多个 broker 发生分区复制提供消息冗余</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-客户端的简单使用">Java 客户端的简单使用<a href="#java-客户端的简单使用" class="hash-link" aria-label="Direct link to Java 客户端的简单使用" title="Direct link to Java 客户端的简单使用">​</a></h3>
<p>生产者：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 配置生产者对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, Object&gt; configMap = new HashMap&lt;String, Object&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 根据配置创建生产者对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(configMap);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 发送数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProducerRecord&lt;String,String&gt; record1 = new ProducerRecord&lt;&gt;(&quot;topic1&quot;, &quot;key1&quot;, &quot;value1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProducerRecord&lt;String,String&gt; record2 = new ProducerRecord&lt;&gt;(&quot;topic1&quot;, &quot;key2&quot;, &quot;value2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer.send(record1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer.send(record2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 关闭生产者对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer.close();</span><br></span></code></pre></div></div>
<p>消费者：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 消费者对象配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, Object&gt; configMap = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(ConsumerConfig.GROUP_ID_CONFIG, &quot;group1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        configMap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;earliest&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 创建消费者对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(configMap);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 订阅 topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumer.subscribe(Collections.singletonList(&quot;topic1&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 拉取数据（超时时间太短可能会得到 0 条数据）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConsumerRecords&lt;String, String&gt; records = consumer.poll(2000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(records.count());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for(ConsumerRecord record : records) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	System.out.println(record);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">输出：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConsumerRecord(topic = topic1, partition = 0, leaderEpoch = 0, offset = 2, CreateTime = 1723463707470, serialized key size = 4, serialized value size = 6, headers = RecordHeaders(headers = [], isReadOnly = false), key = key1, value = value1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConsumerRecord(topic = topic1, partition = 0, leaderEpoch = 0, offset = 3, CreateTime = 1723463707484, serialized key size = 4, serialized value size = 6, headers = RecordHeaders(headers = [], isReadOnly = false), key = key2, value = value2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 关闭消费者对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumer.close();</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="集群">集群<a href="#集群" class="hash-link" aria-label="Direct link to 集群" title="Direct link to 集群">​</a></h3>
<p>配置 zookeeper.properties</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># the directory where the snapshot is stored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataDir=/tmp/cluster/zookeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the port at which the clients will connect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clientPort=2182</span><br></span></code></pre></div></div>
<p>配置 3 个 broker 的 server.properties</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># broker1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The id of the broker. This must be set to a unique integer for each broker.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker.id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zookeeper.connect=localhost:2182</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The address the socket server listens on. If not configured, the host name will be equal to the value of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># java.net.InetAddress.getCanonicalHostName(), with PLAINTEXT listener name, and port 9092.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   FORMAT:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     listeners = listener_name://host_name:port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   EXAMPLE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     listeners = PLAINTEXT://your.host.name:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeners=PLAINTEXT://:9091</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># A comma separated list of directories under which to store log files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log.dirs=/tmp/cluster/broker1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># broker2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker.id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeners=PLAINTEXT://:9091</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log.dirs=/tmp/cluster/broker3/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zookeeper.connect=localhost:2182</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># broker3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker.id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeners=PLAINTEXT://:9091</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log.dirs=/tmp/cluster/broker3/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zookeeper.connect=localhost:2182</span><br></span></code></pre></div></div>
<p>依次启动 zookeeper 和 3 个 kafka broker</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 启动 kafka1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kafka1 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:02:52,658] INFO Kafka startTimeMs: 1724158972653 (org.apache.kafka.common.utils.AppInfoParser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:02:52,659] INFO [KafkaServer id=1] started (kafka.server.KafkaServer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:02:52,763] INFO [zk-broker-1-to-controller-alter-partition-channel-manager]: Recorded new controller, from now on will use node localhost:9091 (id: 1 rack: null) (kafka.server.BrokerToControllerRequestThread)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:02:52,789] INFO [zk-broker-1-to-controller-forwarding-channel-manager]: Recorded new controller, from now on will use node localhost:9091 (id: 1 rack: null) (kafka.server.BrokerToControllerRequestThread)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动 kafka2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kafka1 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,830] INFO [Controller id=1, targetBrokerId=2] Node 2 disconnected. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,831] WARN [Controller id=1, targetBrokerId=2] Connection to node 2 (localhost/127.0.0.1:9092) could not be established. Broker may not be available. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,831] INFO [Controller id=1, targetBrokerId=2] Client requested connection close from node 2 (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,934] INFO [Controller id=1, targetBrokerId=2] Node 2 disconnected. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,934] WARN [Controller id=1, targetBrokerId=2] Connection to node 2 (localhost/127.0.0.1:9092) could not be established. Broker may not be available. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,934] INFO [Controller id=1, targetBrokerId=2] Client requested connection close from node 2 (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kafka2 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:43,985] INFO [KafkaServer id=2] started (kafka.server.KafkaServer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:44,120] INFO [zk-broker-2-to-controller-alter-partition-channel-manager]: Recorded new controller, from now on will use node localhost:9091 (id: 1 rack: null) (kafka.server.BrokerToControllerRequestThread)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:03:44,167] INFO [zk-broker-2-to-controller-forwarding-channel-manager]: Recorded new controller, from now on will use node localhost:9091 (id: 1 rack: null) (kafka.server.BrokerToControllerRequestThread)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动 kafka3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kafka1 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,061] INFO [Controller id=1, targetBrokerId=3] Node 3 disconnected. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,062] WARN [Controller id=1, targetBrokerId=3] Connection to node 3 (localhost/127.0.0.1:9093) could not be established. Broker may not be available. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,062] INFO [Controller id=1, targetBrokerId=3] Client requested connection close from node 3 (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,164] INFO [Controller id=1, targetBrokerId=3] Node 3 disconnected. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,164] WARN [Controller id=1, targetBrokerId=3] Connection to node 3 (localhost/127.0.0.1:9093) could not be established. Broker may not be available. (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,164] INFO [Controller id=1, targetBrokerId=3] Client requested connection close from node 3 (org.apache.kafka.clients.NetworkClient)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kafka3 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,220] INFO [KafkaServer id=3] started (kafka.server.KafkaServer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,373] INFO [zk-broker-3-to-controller-alter-partition-channel-manager]: Recorded new controller, from now on will use node localhost:9091 (id: 1 rack: null) (kafka.server.BrokerToControllerRequestThread)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2024-08-20 21:04:48,391] INFO [zk-broker-3-to-controller-forwarding-channel-manager]: Recorded new controller, from now on will use node localhost:9091 (id: 1 rack: null) (kafka.server.BrokerToControllerRequestThread)</span><br></span></code></pre></div></div>
<p>zookeeper 的 /brokers/ids 下有 id <code>1，2，3</code>， zookeeper 的 /controler 显示</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;brokerid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;1724158972518&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;kraftControllerEpoch&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">-1</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>kafka 3.8 版本以后可以不需要 zookeeper，通过 kraft 算法代替。</p>
<p>Zookeeper 是一个开源的分布式的，为分布式框架提供协调服务的Apache项目。</p>
<p>ZooKeeper 数据模型的结构类似 Linux 文件系统，每个 zNode 节点通过其路径唯一标识。</p>
<p>kafka broker 会注册到 zookeeper 上，每个 broker 会有全局唯一 id，会把 ip 和端口注册到 zookeeper 中。kafka 连接上 zookepper 后会在 zookepper 上创建 ZNode，有持久化的也有临时的，临时的在连接断开会删除。</p>
<p>broker 注册到 zookeeper 上会选举管理者 controller ，controller 如果 down 了会重新选举</p>
<p>第一个 broker 启动，会在 /brokers/ids 下注册，然后监听 /controller ，然后注册 /controller 节点，选举成为 controller。第二个 broker 启动，会在 /brokers/ids 下注册，然后监听 /controller ，然后注册 /controller 节点，然后会通知 broker1 集群的变化，broker1 会连接所有的 broker 并发送集群相关数据。controller 如果 down 了，监听 /controller 的 broker 会收到通知</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用">使用<a href="#使用" class="hash-link" aria-label="Direct link to 使用" title="Direct link to 使用">​</a></h3>
<p>创建 topic</p>
<p>直接向 kafka 不存在的 topic 发送消息，会发送成功，并自动创建主题，如果不需要，可以配置 <code>auto.create.topics.enable=false</code> 。通常不会用这种方式创建主题，而是手动创建。手动创建可以指定分区数和副本数。</p>
<p>NewTopic 对象创建的时候传入 3 个参数，分别是，topic 名称，分区数量，副本因子。这里 admin 只配置了 9092 ，它可以从 9092 中拿到集群信息，并在各个 broker 中创建 partition 和 node</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HashMap&lt;String,Object&gt; configMap = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configMap.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Admin admin = Admin.create(configMap);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NewTopic topic1 = new NewTopic(&quot;topic1&quot;, 1, (short) 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NewTopic topic2 = new NewTopic(&quot;topic1&quot;, 2, (short) 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin.createTopics(Arrays.asList(topic1, topic2));</span><br></span></code></pre></div></div>
<p>创建完成后可以看到如下文件夹</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/cluster/broker1/data/topic1-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/cluster/broker1/data/topic2-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/cluster/broker2/data/topic2-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/cluster/broker2/data/topic2-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/cluster/broker3/data/topic2-1</span><br></span></code></pre></div></div>
<p>通过可视化工具 Kafdrop 可以看到 topic1 只有一个 partition0 ，leader node 和 replica node 只有一个 1。 topic2 的 partition0 的 leader node 是 1，replica node 是 1,2，partition1 的 leader node 是 2，replica node 是 2,3</p>
<p>kafka 会尽可能均匀分布 leader node ，以防止热点问题</p>
<p>也可以手动指定分区和副本</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HashMap&lt;Integer, List&lt;Integer&gt;&gt; partitionMap = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// partition0 在 2,3 ，partition1 在 3,1 ，每个 partition 的第一个为 leadder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">partitionMap.put(0, Arrays.asList(2,3));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">partitionMap.put(1, Arrays.asList(3,1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NewTopic topic3 = new NewTopic(&quot;topic3&quot;, partitionMap);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin.createTopics(Arrays.asList(topic3));</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/note/tool/oracle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Oracle</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/note/tool/mongo"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mongo DB</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#快速上手" class="table-of-contents__link toc-highlight">快速上手</a></li><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#java-客户端的简单使用" class="table-of-contents__link toc-highlight">Java 客户端的简单使用</a></li><li><a href="#集群" class="table-of-contents__link toc-highlight">集群</a></li><li><a href="#使用" class="table-of-contents__link toc-highlight">使用</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/note/algorithmPractice">Algorithm</a></li><li class="footer__item"><a class="footer__link-item" href="/note/designPattern">Design Pattern</a></li><li class="footer__item"><a class="footer__link-item" href="/note/docker">Docker</a></li><li class="footer__item"><a class="footer__link-item" href="/note/java">Java</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Jianfeng's Site. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>