<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-note docs-version-current docs-doc-page docs-doc-id-tool/hadoop" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Hadoop | 健峰的网站</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wjftu.com/note/tool/hadoop"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-note-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-note-current"><meta data-rh="true" property="og:title" content="Hadoop | 健峰的网站"><meta data-rh="true" name="description" content="安装 ubuntu 20.04 虚拟机"><meta data-rh="true" property="og:description" content="安装 ubuntu 20.04 虚拟机"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wjftu.com/note/tool/hadoop"><link data-rh="true" rel="alternate" href="https://wjftu.com/note/tool/hadoop" hreflang="en"><link data-rh="true" rel="alternate" href="https://wjftu.com/note/tool/hadoop" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"开发工具","item":"https://wjftu.com/note/tool/"},{"@type":"ListItem","position":2,"name":"Hadoop","item":"https://wjftu.com/note/tool/hadoop"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="健峰的网站 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="健峰的网站 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-155045877-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.1b9fda11.css">
<script src="/assets/js/runtime~main.fa7b6039.js" defer="defer"></script>
<script src="/assets/js/main.d6ce1d32.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/note">Note</a><a class="navbar__item navbar__link" href="/life/2023">Life</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/note/tool/">开发工具</a><button aria-label="Collapse sidebar category &#x27;开发工具&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/maven">Maven</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/gradle">Gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/oracle">Oracle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/kafka">Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/tool/mongo">Mongo DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/note/tool/hadoop">Hadoop</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/note/">笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/docker/">Docker</a><button aria-label="Expand sidebar category &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/java/">Java</a><button aria-label="Expand sidebar category &#x27;Java&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/kubernetes/">Kubenetes</a><button aria-label="Expand sidebar category &#x27;Kubenetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/springboot/">Spring Boot</a><button aria-label="Expand sidebar category &#x27;Spring Boot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/designPattern/">设计模式</a><button aria-label="Expand sidebar category &#x27;设计模式&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/algorithmPractice/">算法刷题</a><button aria-label="Expand sidebar category &#x27;算法刷题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/springcloud/">Spring Cloud</a><button aria-label="Expand sidebar category &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/cloud/">云技术</a><button aria-label="Expand sidebar category &#x27;云技术&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/note/frontend/">前端</a><button aria-label="Expand sidebar category &#x27;前端&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/note/tool/"><span>开发工具</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Hadoop</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hadoop</h1></header>
<p>安装 ubuntu 20.04 虚拟机</p>
<p>也可以是实体机，不过没那么多机器。。。可以用 virtual box 安装多台虚拟机</p>
<p>查看和后台启动虚拟机</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VBoxManage list vms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VBoxManage startvm &quot;uuid&quot; –type headless</span><br></span></code></pre></div></div>
<p>安装 ifconfig ，用于查看ip</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install ifconfig</span><br></span></code></pre></div></div>
<p>安装 openssh-server 以便于 ssh 连接</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install openssh-server</span><br></span></code></pre></div></div>
<p>安装 openssh-server 遇到报错，先安装依赖</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install openssh-client=1:8.2p1-4ubuntu0.2</span><br></span></code></pre></div></div>
<p>使用命令 <code>ssh-keygen -t rsa</code> 生成公私钥，将公钥写入服务器的 <code>~/.ssh/authorized_keys</code>  文件内，以便免密登陆</p>
<p>debian 安装</p>
<p>配置国内源，参考 <a href="https://developer.aliyun.com/mirror/debian/" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/mirror/debian/</a></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 ifconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install net-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install openssh-server</span><br></span></code></pre></div></div>
<p>生成密钥</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -t rsa</span><br></span></code></pre></div></div>
<p>将公钥写入 ~/.ssh/authorizedkeys ，以便免密登录</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装-jdk8">安装 jdk8<a href="#安装-jdk8" class="hash-link" aria-label="Direct link to 安装 jdk8" title="Direct link to 安装 jdk8">​</a></h3>
<p>将 jdk-8u202-linux-x64.tar.gz 文件解压到 /usr/java</p>
<p>根据 <a href="https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions" target="_blank" rel="noopener noreferrer">https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions</a> ，hadoop 3.2 支持 jdk 8 编译和运行</p>
<p>配置环境变量</p>
<p>编辑 /etc/profile ，添加</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export JAVA_HOME=/usr/java/jdk1.8.0_202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$PATH:$JAVA_HOME/bin</span><br></span></code></pre></div></div>
<p>运行 <code>source /etc/profile</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装-hadoop">安装 hadoop<a href="#安装-hadoop" class="hash-link" aria-label="Direct link to 安装 hadoop" title="Direct link to 安装 hadoop">​</a></h3>
<p>下载 hadoop ，解压到一个文件夹，如 /server</p>
<p>运行 bin/hadoop</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ./bin/hadoop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage: hadoop [OPTIONS] SUBCOMMAND [SUBCOMMAND OPTIONS]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">or    hadoop [OPTIONS] CLASSNAME [CLASSNAME OPTIONS]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where CLASSNAME is a user-provided Java class</span><br></span></code></pre></div></div>
<p>默认是单机模式，测试运行</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cp etc/hadoop/*.xml input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.5.jar grep input output &#x27;dfs[a-z.]+&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat output/*</span><br></span></code></pre></div></div>
<p>单节点和伪分布式参考 <a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="noopener noreferrer">https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html</a> ，集群参考 ttps://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/ClusterSetup.html</p>
<p>编辑 etc/hadoop/hadoop-env.sh ，添加</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export JAVA_HOME=/usr/java/jdk1.8.0_202</span><br></span></code></pre></div></div>
<p>如果是 root 用户，还需要加上下面这些，不然会报错</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export HDFS_NAMENODE_USER=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HDFS_DATANODE_USER=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HDFS_SECONDARYNAMENODE_USER=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export YARN_RESOURCEMANAGER_USER=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export YARN_NODEMANAGER_USER=root</span><br></span></code></pre></div></div>
<p>格式化文件系统</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bin/hdfs namenode -format</span><br></span></code></pre></div></div>
<p>运行</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># sbin/start-dfs.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting namenodes on [localhost]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting datanodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting secondary namenodes [ubuntu0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu0: Warning: Permanently added &#x27;ubuntu0,192.168.56.3&#x27; (ECDSA) to the list of known hosts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4488 NameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4843 SecondaryNameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4635 DataNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4973 Jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a href="#配置" class="hash-link" aria-label="Direct link to 配置" title="Direct link to 配置">​</a></h3>
<p>概念：</p>
<p>NameNode 主节点管理者<br>
<!-- -->DataNode 从节点工作者<br>
<!-- -->SecondaryNameNode 主节点辅助者</p>
<p>配置文件：</p>
<p>文件夹 etc/hadoop/</p>
<p>workers： 从节点 DataNode 有哪些<br>
<!-- -->hadoop-env.sh 相关环境变量<br>
<!-- -->core-site.xml 核心配置文件<br>
<!-- -->hdfs-site.xml HDFS 核心配置文件</p>
<p>三台虚拟机 node0 node1 node2，配置好网络 hostonly 以便能访问彼此，生成密钥并把公钥放入 ~/.ssh/authorized_keys ，配置好 /etc/hosts</p>
<p>修改 etc/hadoop 下的配置文件</p>
<p>配置 workers</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim wokers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node2</span><br></span></code></pre></div></div>
<p>修改 hadoop-env.sh 配置环境变量</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export JAVA_HOME=/server/jdk1.8.0_202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_HOME=/server/hadoop-3.3.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_CONF_DIR=@HADOOP_HOME/etc/hadoop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_LOG_DIR=@HADOOP_HOME/logs</span><br></span></code></pre></div></div>
<p>配置 core-site.xml</p>
<p>配置 HDFS 文件系统的网络通讯路径</p>
<p>配置 namenode 为 node0 ，缓冲区大小为 131072</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">fs.defaultFS</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hdfs://node0:8020</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.file.buffer.size</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4096</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>配置 hdfs-site.xml</p>
<p>依次为默认文件权限，namenode 元数据存储位置，namenode 允许哪几台节点连接，hdfs默认块大小，namenode 并发线程数，从节点 datanode 数据存储目录</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.datanode.data.dir.perm</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">700</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.name.dir</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">/server/nn</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.hosts</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">node0,node1,node2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.blocksize</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">134217728</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.namenode.handler.count</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">100</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">dfs.datanode.data.dir</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">/server/dn</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>设置环境变量</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export JAVA_HOME=/server/jdk1.8.0_202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_HOME=/server/hadoop-3.3.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span></code></pre></div></div>
<p>复制配置文件</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp workers wjf@192.168.56.8:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp workers wjf@192.168.56.9:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp hadoop-env.sh wjf@192.168.56.8:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp hadoop-env.sh wjf@192.168.56.9:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp core-site.xml wjf@192.168.56.8:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp core-site.xml wjf@192.168.56.9:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp hdfs-site.xml wjf@192.168.56.8:/server/hadoop-3.3.5/etc/hadoop/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp hdfs-site.xml wjf@192.168.56.9:/server/hadoop-3.3.5/etc/hadoop/</span><br></span></code></pre></div></div>
<p>node0 格式化 namenode</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># hadoop namenode -format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: Use of this script to execute namenode is deprecated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: Attempting to execute replacement &quot;hdfs namenode&quot; instead.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:41,711 INFO namenode.NameNode: STARTUP_MSG: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STARTUP_MSG: Starting NameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STARTUP_MSG:   host = debian0/127.0.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STARTUP_MSG:   args = [-format]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STARTUP_MSG:   version = 3.3.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:45,336 INFO namenode.FSImageFormatProtobuf: Image file /server/nn/current/fsimage.ckpt_0000000000000000000 of size 396 bytes saved in 0 seconds .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:45,368 INFO namenode.NNStorageRetentionManager: Going to retain 1 images with txid &gt;= 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:45,408 INFO namenode.FSNamesystem: Stopping services started for active state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:45,410 INFO namenode.FSNamesystem: Stopping services started for standby state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:45,415 INFO namenode.FSImage: FSImageSaver clean checkpoint: txid=0 when meet shutdown.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-16 22:24:45,418 INFO namenode.NameNode: SHUTDOWN_MSG: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHUTDOWN_MSG: Shutting down NameNode at debian0/127.0.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">************************************************************/</span><br></span></code></pre></div></div>
<p>启动 namenode</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@debian0:/server$ start-dfs.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting namenodes on [node0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting datanodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting secondary namenodes [debian0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@debian0:/server$ jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3856 Jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3740 SecondaryNameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3613 DataNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>datanode 也被启动</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1590 DataNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1640 Jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>访问 node0:9870 可以看到管理界面</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hdfs">HDFS<a href="#hdfs" class="hash-link" aria-label="Direct link to HDFS" title="Direct link to HDFS">​</a></h3>
<p>HDFS 是 hadoop 的分布式存储组建</p>
<p>全启全停： start-dfs.sh stop-dfs.sh
单独进程启动停止： <code>hdfs --daemon (stat|stop|status) (namenode|datanode|secondarynamenode)</code></p>
<p>区分文件系统（hadoop可以自动识别）</p>
<p>Linux:  file///usr/local/a.txt
HDFS:  hdfs://node1:9020/usr/local/a.txt</p>
<p>老版本命令 <code>hadoop fs [generic options]</code> ，新版本 <code>hdfs dfs [generic options]</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -mkdir -p /home/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -ls -h -R /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x   - wjf supergroup          0 2023-05-17 22:03 /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x   - wjf supergroup          0 2023-05-17 22:03 /home/a</span><br></span></code></pre></div></div>
<p>上传 下载 复制</p>
<p>上传可以通过 <code>-D dfs.replication=2</code> 临时修改副本</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -put [-f] [-p] &lt;localsrc&gt;...  &lt;dest&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -put README.txt hdfs://node0:8020/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -put -D dfs.replication=2 README.txt hdfs://node0:8020/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -cat /README.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For the latest information about Hadoop, please visit our website at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   http://hadoop.apache.org/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and our wiki, at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   https://cwiki.apache.org/confluence/display/HADOOP/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 复制 hdfs dfs -cp [-f] &lt;source&gt; &lt;dest&gt; （两个路径都是 hdfs）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -cp /README.txt /README2.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># hdfs dfs -get [-f] [-p] &lt;localsrc&gt;...  &lt;dest&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -get /README2.txt .</span><br></span></code></pre></div></div>
<p>追加到文件（文件无法编辑，只能够删除和追加）</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ echo &quot;aaa&quot; &gt;&gt; 1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -appendToFile 1.txt /README.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -cat /README.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For the latest information about Hadoop, please visit our website at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   http://hadoop.apache.org/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and our wiki, at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   https://cwiki.apache.org/confluence/display/HADOOP/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aaa</span><br></span></code></pre></div></div>
<p>文件的移动（或改名）和删除</p>
<p>删除 -rm ， skipTrash 表示跳过回收站，但回收站默认是不开启的，默认情况无需 skipTrash 即可永久删除</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -mv /README.txt /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -ls -h -R /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup        175 2023-05-17 22:20 /README2.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x   - wjf supergroup          0 2023-05-17 22:35 /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup        179 2023-05-17 22:33 /home/README.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x   - wjf supergroup          0 2023-05-17 22:03 /home/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除 hdfs dfs -rm [-r] [-skipTrash] &lt;src&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hdfs dfs -rm -r /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deleted /home</span><br></span></code></pre></div></div>
<p>更多命令可以参考 <a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/FileSystemShell.html" target="_blank" rel="noopener noreferrer">https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/FileSystemShell.html</a></p>
<p>除了使用命令，也可以用 web-ui <a href="http://node0:9870/explorer.html#/" target="_blank" rel="noopener noreferrer">http://node0:9870/explorer.html#/</a> ，网页的权限是 dr.who 是没有权限操作的，可以通过配置文件赋予某个用户的权限，但是不安全</p>
<p>查看集群文件副本。默认文件按 block 分割，默认 256MB， 默认每个块 3 个副本，可以通过 <code>dfs.replication</code> 配置副本数</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:~$ hdfs fsck /wjf/aa/hosts -files -blocks -locations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to namenode via http://node0:9870/fsck?ugi=wjf&amp;files=1&amp;blocks=1&amp;locations=1&amp;path=%2Fwjf%2Faa%2Fhosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FSCK started by wjf (auth:SIMPLE) from /192.168.56.7 for path /wjf/aa/hosts at Thu May 18 20:53:52 CST 2023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/wjf/aa/hosts 228 bytes, replicated: replication=3, 1 block(s):  OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0. BP-1743682380-127.0.1.1-1684248434454:blk_1073741827_1005 len=228 Live_repl=3  [DatanodeInfoWithStorage[192.168.56.7:9866,DS-4f33e3c9-e8e1-4d70-b3dd-3de2882ecd31,DISK], DatanodeInfoWithStorage[192.168.56.9:9866,DS-03fb8214-a502-4a27-8ba0-5c7c18636708,DISK], DatanodeInfoWithStorage[192.168.56.8:9866,DS-3073fa17-c53e-49fe-b29a-6adf9dc840eb,DISK]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status: HEALTHY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Number of data-nodes:	3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Number of racks:		1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total dirs:			0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total symlinks:		0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Replicated Blocks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total size:	228 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total files:	1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total blocks (validated):	1 (avg. block size 228 B)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Minimally replicated blocks:	1 (100.0 %)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Over-replicated blocks:	0 (0.0 %)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Under-replicated blocks:	0 (0.0 %)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Mis-replicated blocks:		0 (0.0 %)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Default replication factor:	3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Average block replication:	3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Missing blocks:		0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Corrupt blocks:		0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Missing replicas:		0 (0.0 %)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Blocks queued for replication:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Erasure Coded Block Groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total size:	0 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total files:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Total block groups (validated):	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Minimally erasure-coded block groups:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Over-erasure-coded block groups:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Under-erasure-coded block groups:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Unsatisfactory placement block groups:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Average block group size:	0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Missing block groups:		0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Corrupt block groups:		0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Missing internal blocks:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Blocks queued for replication:	0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FSCK ended at Thu May 18 20:53:52 CST 2023 in 16 milliseconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The filesystem under path &#x27;/wjf/aa/hosts&#x27; is HEALTHY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>edits 文件记录 hdfs 每一次操作，edits 达到上限大小后会开启新的文件记录。FSImage 文件是 edits 操作的合并（某个时间节点前的全部文件状态信息），会定期将全部 edits 文件与 fsimage 合并形成新的 fsimage 。文件存放在 <code>dfs.datanode.data.dir</code> ，默认 1 小时或 100 万事务会合并元数据，合并操作由 secondarynamenode 执行</p>
<p>写入流程：</p>
<p>客户端发送请求到 namenode 。namenode 审核，若满足条件允许写入，告知客户端写入的 datanode 地址。客户端向 datanode 发送数据包。datanode 同时完成副本复制工作，并将数据发给其他 datanode。写入完成后通知 namenode， namenode 记录元数据。</p>
<p>namenode 不负责写入，只负责记录元数据和审批权限。datanode 写数据，但客户端只需向其中一台 datanode 发送，副本复制由 datanode 之间自行完成。</p>
<p>读取流程：</p>
<p>客户端发送读取请求， namenode 允许并告知 block 列表，客户端根据 block 列表自行从 datanode 读取所需的 block</p>
<p>namenode 提供的 block 会根据网络距离计算，尽量离客户端近</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce-和-yarn">MapReduce 和 Yarn<a href="#mapreduce-和-yarn" class="hash-link" aria-label="Direct link to MapReduce 和 Yarn" title="Direct link to MapReduce 和 Yarn">​</a></h3>
<p>分散 - 汇总</p>
<p>MapReduce 是基于 YARN 运行的，YARN 是资源调度组件。</p>
<p>YARN 架构： 主从架构，主（master）角色：ResourceManager 整个集群的资源调度着，从（slave）角色：NodeManager 单个服务的调度者，接受 Resource Manager 的任务，创建容器，回收资源。</p>
<p>node0 搭建 ResourceManager NodeManager ProxyServer JobHistoryServer ， node1 node2 搭建 NodeManager</p>
<p>配置 mapreduce</p>
<p>mapred-env.sh</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export JAVA_HOME=/server/jdk1.8.0_202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># JobHistoryServer 进程内存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_JOB_HISTORYSERVER_HEAPSIZE=256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 日志级别</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_MAPRED_ROOT_LOGGER=INFO,RFA</span><br></span></code></pre></div></div>
<p>mapred-site.xml</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.framework.name</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">运行框架设置为yarn</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.jobhistory.address</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">node0:10020</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">JobHistoryServer</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">yarn.app.mapreduce.am.env</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">HADOOP_MAPRED_HOME=${HADOOP_HOME}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.map.env</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">HADOOP_MAPRED_HOME=${HADOOP_HOME}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">mapreduce.reduce.env</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">HADOOP_MAPRED_HOME=${HADOOP_HOME}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>yarn-env.sh</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export JAVA_HOME=/server/jdk1.8.0_202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_HOME=/server/hadoop-3.3.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_CONFIG_DIR=${HADOOP_HOME}/etc/hadoop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_LOG_DIR=${HADOOP_HOME}/logs</span><br></span></code></pre></div></div>
<p>yarn-site.xml</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;node0&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.nodemanager.local-dirs&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;/server/nm-local&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;nodemanager中间数据存储路径&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.nodemanager.log-dirs&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;/server/nm-log&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;nodemanager数据日志本地存储路径&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;为mapreduce开启shuffle服务&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.log.server.url&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;http://node0:19888/jobhistory/logs&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;历史服务器url&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.web.proxy.address&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;hode0:8089&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;代理服务器&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.log.aggregation-enable&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;true&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;日志聚合&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.nodemanager.remote-app-log-dir&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;/tmp/logs&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;程序日志HDFS存储路径&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;yarn.resourcemanager.scheduler.class&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;选择公平调度器&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>复制配置文件</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scp mapred-env.sh mapred-site.xml yarn-env.sh yarn-site.xml node1:`pwd`/ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scp mapred-env.sh mapred-site.xml yarn-env.sh yarn-site.xml node2:`pwd`/</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 集群启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start-yarn.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 集群停止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop-yarn.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 单台操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn --daemon start|stop resourcemanager|nodemanager|proxyserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 历史服务器启动和停止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#mapred --daemon start|stop historyserver</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2081 NodeManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1235 DataNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1141 NameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1365 SecondaryNameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2535 Jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2474 JobHistoryServer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1994 ResourceManager</span><br></span></code></pre></div></div>
<p>可以通过 <a href="http://node0:8088/" target="_blank" rel="noopener noreferrer">http://node0:8088/</a> 查看 yarn 页面，<a href="http://node0:19888/" target="_blank" rel="noopener noreferrer">http://node0:19888/</a> 可以查看 historyserver 页面</p>
<p>yarn 启动时从 yarn-site.xml 读取配置，确定 ResourceManager 所在机器，启动它。读取 workers 文件，启动全部 NodeManager。在当前机器启动 ProxyServer</p>
<p>yarn 可以运行 MapReduce 、 Spark 、 Flink 程序</p>
<p>mapreduce 启动命令</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hadoop jar [程序文件] [java类名] [参数1] [参数2]</span><br></span></code></pre></div></div>
<p>试着运行一下 mapreduce 程序。在 hdfs 中放置一个文本文件在 /input 目录，运行 wordcount</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ hadoop jar /server/hadoop-3.3.5/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.5.jar wordcount hdfs://node0:8020/input hdfs://node0:8020/output/wc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:16,556 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at node0/192.168.56.7:8032</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:17,355 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/wjf/.staging/job_1684762859481_0003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:17,781 INFO input.FileInputFormat: Total input files to process : 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:17,927 INFO mapreduce.JobSubmitter: number of splits:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,171 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1684762859481_0003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,171 INFO mapreduce.JobSubmitter: Executing with tokens: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,400 INFO conf.Configuration: resource-types.xml not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,402 INFO resource.ResourceUtils: Unable to find &#x27;resource-types.xml&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,482 INFO impl.YarnClientImpl: Submitted application application_1684762859481_0003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,561 INFO mapreduce.Job: The url to track the job: http://node0:8088/proxy/application_1684762859481_0003/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:18,562 INFO mapreduce.Job: Running job: job_1684762859481_0003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:27,908 INFO mapreduce.Job: Job job_1684762859481_0003 running in uber mode : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:27,924 INFO mapreduce.Job:  map 0% reduce 0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:36,064 INFO mapreduce.Job:  map 100% reduce 0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:44,165 INFO mapreduce.Job:  map 100% reduce 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:14:45,193 INFO mapreduce.Job: Job job_1684762859481_0003 completed successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	File Input Format Counters </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		Bytes Read=49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	File Output Format Counters </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		Bytes Written=48</span><br></span></code></pre></div></div>
<p>查看结果</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5/etc/hadoop$ hdfs dfs -ls -R -h /output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x   - wjf supergroup          0 2023-05-22 22:14 /output/wc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup          0 2023-05-22 22:14 /output/wc/_SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup         48 2023-05-22 22:14 /output/wc/part-r-00000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5/etc/hadoop$ hdfs dfs -cat /output/wc/part-r-00000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">afternoon	1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bye	1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">good	3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello	1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hi	2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">morning	1</span><br></span></code></pre></div></div>
<p>3 个节点 10000 样本蒙特卡罗求圆周率</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/hadoop-3.3.5$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.5.jar pi 3 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of Maps  = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Samples per Map = 10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wrote input for Map #0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wrote input for Map #1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wrote input for Map #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:33:32,244 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at node0/192.168.56.7:8032</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:33:32,789 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/wjf/.staging/job_1684762859481_0005</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:33:33,000 INFO input.FileInputFormat: Total input files to process : 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-22 22:33:33,113 INFO mapreduce.JobSubmitter: number of splits:3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job Finished in 29.323 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Estimated value of Pi is 3.14146666666666666667</span><br></span></code></pre></div></div>
<p>实现分布式计算是不容易的，MapReduce 可以让我们通过实现接口的方式完成业务逻辑，无需管理资源，具有容错性。MapReduce 不擅长实时响应的计算，不擅长串行计算。</p>
<p>MrAppMaster 负责调度和状态协调，MapTask 负责整个数据处理流程，ReduceTask 负责 Reduce 阶段数据处理</p>
<p>依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.hadoop</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop-client</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.1.3</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4.12</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.slf4j</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">slf4j-log4j12</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.7.30</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>一个 word count 示例程序</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.IntWritable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.LongWritable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Mapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WordCountMapper extends Mapper&lt;LongWritable, Text,Text, IntWritable&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Text outK = new Text();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private IntWritable outV = new IntWritable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, IntWritable&gt;.Context context) throws IOException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String line = value.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String[] words = line.split(&quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for(String w: words) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            outK.set(w);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            outV.set(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            context.write(outK, outV);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Reducer</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.IntWritable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Reducer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WordCountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IntWritable outV = new IntWritable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context) throws IOException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int sum = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for(IntWritable value: values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sum += value.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outV.set(sum);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.write(key, outV);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Driver</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.conf.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.fs.Path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.IntWritable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Job;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WordCountDriver {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException, InterruptedException, ClassNotFoundException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //1 获取job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration conf = new Configuration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Job job = Job.getInstance(conf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2 设置 jar 路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setJarByClass(WordCountDriver.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 3 关联 mapper 和 reducer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapperClass(WordCountMapper.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setReducerClass(WordCountReducer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 4 设置 map 输出的 k v 类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapOutputKeyClass(Text.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapOutputValueClass(IntWritable.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 5 设置最终输出的 k v 类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setOutputKeyClass(Text.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setOutputValueClass(IntWritable.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 6 设置输入输出路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileInputFormat.setInputPaths(job, new Path(&quot;src/main/resources/input&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileOutputFormat.setOutputPath(job, new Path(&quot;src/main/resources/output&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 7 提交 job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 监控并打印信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean result = job.waitForCompletion(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.exit(result ? 0 : 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>输出文件：</p>
<p>_SUCCESS 为信号文件，表示结果成功，part-r-00000 为 00000 分区的结果</p>
<p>在 hadoop 集群上运行：maven 打包（无需带依赖，因为 hadoop 集群上有需要的依赖），将 jar 包放到节点上，将数据放入输入路径，确保输出路径为空</p>
<p>运行，指定 jar 包和全类名</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hadoop jar wordcount.jar com.wjftu.WordCountDriver</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hive">Hive<a href="#hive" class="hash-link" aria-label="Direct link to Hive" title="Direct link to Hive">​</a></h3>
<p>Metastore 用于元数据存储</p>
<p>Driver 驱动程序完成 sql 解析，执行优化，代码提交</p>
<p>用户接口提供用户交互功能</p>
<p>Hive 是单机工具，但可以提交到分布式的 MapReduce 程序运行</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dev.mysql.com/get/mysql-apt-config_0.8.18-1_all.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dpkg -i mysql-apt-config_0.8.18-1_all.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 选择 debian buster -&gt; myusql server -&gt; mysql-5.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 467B942D3A79BD29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt update </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y mysql-community-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable mysql</span><br></span></code></pre></div></div>
<p>core-site.xml 添加配置，允许代理</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop.proxyuser.hadoop.hosts</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hadoop.proxyuser.hadoop.groups</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">*</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p><a href="https://archive.apache.org/dist/" target="_blank" rel="noopener noreferrer">https://archive.apache.org/dist/</a> 从 apache archive 下载 Hive ，以及 Hive 需要的 mysql 驱动。Hive 有元数据管理功能，需要数据库，这里用 MySql</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://archive.apache.org/dist/hive/hive-3.1.3/apache-hive-3.1.3-bin.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://search.maven.org/remotecontent?filepath=com/mysql/mysql-connector-j/8.0.33/mysql-connector-j-8.0.33.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf apache-hive-3.1.3-bin.tar.gz </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv mysql-connector-j-8.0.33.jar apache-hive-3.1.3-bin/lib/</span><br></span></code></pre></div></div>
<p>创建数据库</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> hive </span><span class="token keyword" style="color:#00009f">charset</span><span class="token plain"> utf8</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>配置 hive-env.sh</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export HADOOP_HOME=/server/hadoop-3.3.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HIVE_CONF_DIR=/server/apache-hive-3.1.3-bin/conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HIVE_AUX_JARS_PATH=/server/apache-hive-3.1.3-bin/lib</span><br></span></code></pre></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionURL</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jdbc:mysql://node0:3306/hive?createDatabaseIfNotExist=true</span><span class="token entity named-entity" style="color:#36acaa">&amp;amp;</span><span class="token plain">useSSL=false</span><span class="token entity named-entity" style="color:#36acaa">&amp;amp;</span><span class="token plain">useUnicode=true</span><span class="token entity named-entity" style="color:#36acaa">&amp;amp;</span><span class="token plain">charsetEncoding=UTF-8</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionDriverName</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.mysql.cj.jdbc.Driver</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionUserName</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">root</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">javax.jdo.option.ConnectionPassword</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">123456</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.server2.thrift.bind.host</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">node0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.metastore.uris</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">thrift://node0:9083</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hive.metastore.event.db.notification.api.auth</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">property</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">configuration</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>运行 bin/schematool ，初始化元数据，制定数据库为 mysql ，verbos 表示输出详细信息</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./schematool -initSchema -dbType mysql -verbos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Class path contains multiple SLF4J bindings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/apache-hive-3.1.3-bin/lib/log4j-slf4j-impl-2.17.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/hadoop-3.3.5/share/hadoop/common/lib/slf4j-reload4j-1.7.36.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metastore connection URL:	 jdbc:mysql://node0:3306/hive?createDatabaseIfNotExist=true&amp;useSSL=false&amp;useUnicode=true&amp;charsetEncoding=UTF-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metastore Connection Driver :	 com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metastore connection User:	 root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting metastore schema initialization to 3.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Initialization script hive-schema-3.1.0.mysql.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Initialization script completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schemaTool completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>会初始化很多表</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show tables;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Tables_in_hive                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| AUX_TABLE                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| BUCKETING_COLS                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| CDS                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| COLUMNS_V2                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| COMPACTION_QUEUE              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| WM_POOL                       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| WM_POOL_TO_TRIGGER            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| WM_RESOURCEPLAN               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| WM_TRIGGER                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| WRITE_SET                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">74 rows in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>启动元数据管理服务（不然无法使用），Jps 显示为 RunJar</p>
<p>（启动之前新建日志文件夹 logs）</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 前台启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin/hive --service metastore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 后台启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nohup bin/hive --service metastore &gt;&gt; logs/metastore.log 2&gt;&amp;1 &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/apache-hive-3.1.3-bin$ jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2341 Jps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1686 NameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1913 SecondaryNameNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1372 RunJar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1773 DataNode</span><br></span></code></pre></div></div>
<p>有两种客户端， 一种是 Hive shell， 可直接写 sql ， 通过 <code>bin/hive</code>  启动。另一种是 Hive ThriftServer ，需要连接外部客户端， <code>bin/hive --service hiveserver2</code></p>
<p>（启动客户端之前先把 hdfs 和 yarn 启动起来）</p>
<p>可以看到有一个 default 数据库</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bin/hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Class path contains multiple SLF4J bindings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/apache-hive-3.1.3-bin/lib/log4j-slf4j-impl-2.17.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hive Session ID = d93a6567-47b3-43d8-b6da-5eb936f5c6d9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hive&gt; show databases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time taken: 0.031 seconds, Fetched: 1 row(s)</span><br></span></code></pre></div></div>
<p>创建表，插入数据，需要计算的 sql 会经过 mapReduce，用时特别长。。。可以在 yarn 的页面查看任务</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hive&gt; create table test(id int, name string, gender string);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hive&gt; insert into test(id, name, gender) values(3,&#x27;jim&#x27;,&#x27;M&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query ID = wjf_20230525225053_71997c85-7263-459a-8a7c-25a95db71411</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total jobs = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Launching Job 1 out of 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of reduce tasks determined at compile time: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to change the average load for a reducer (in bytes):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to limit the maximum number of reducers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set hive.exec.reducers.max=&lt;number&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to set a constant number of reducers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set mapreduce.job.reduces=&lt;number&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting Job = job_1685026202353_0001, Tracking URL = http://node0:8088/proxy/application_1685026202353_0001/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kill Command = /server/hadoop-3.3.5/bin/mapred job  -kill job_1685026202353_0001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-25 22:51:54,775 Stage-1 map = 0%,  reduce = 0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-25 22:52:11,383 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 3.4 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-25 22:52:32,190 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 5.83 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MapReduce Total cumulative CPU time: 5 seconds 830 msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ended Job = job_1685026202353_0001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stage-4 is selected by condition resolver.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stage-3 is filtered out by condition resolver.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stage-5 is filtered out by condition resolver.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Moving data to directory hdfs://node0:8020/user/hive/warehouse/test/.hive-staging_hive_2023-05-25_22-50-53_595_7784313467016506868-1/-ext-10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loading data to table default.test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MapReduce Jobs Launched: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 5.83 sec   HDFS Read: 16341 HDFS Write: 273 SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total MapReduce CPU Time Spent: 5 seconds 830 msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time taken: 102.321 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hive&gt; select * from test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3	jim	M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time taken: 0.326 seconds, Fetched: 1 row(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hive&gt; select gender, count(*) from test group by gender;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query ID = wjf_20230525225744_71573bcb-9912-4616-b40a-34da45252226</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total jobs = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Launching Job 1 out of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of reduce tasks not specified. Estimated from input data size: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to change the average load for a reducer (in bytes):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to limit the maximum number of reducers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set hive.exec.reducers.max=&lt;number&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In order to set a constant number of reducers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set mapreduce.job.reduces=&lt;number&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting Job = job_1685026202353_0002, Tracking URL = http://node0:8088/proxy/application_1685026202353_0002/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kill Command = /server/hadoop-3.3.5/bin/mapred job  -kill job_1685026202353_0002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-25 22:58:34,876 Stage-1 map = 0%,  reduce = 0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-25 22:58:46,462 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 2.16 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-05-25 22:59:03,818 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 5.49 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MapReduce Total cumulative CPU time: 5 seconds 490 msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ended Job = job_1685026202353_0002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MapReduce Jobs Launched: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 5.49 sec   HDFS Read: 12811 HDFS Write: 103 SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total MapReduce CPU Time Spent: 5 seconds 490 msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">M	1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time taken: 80.142 seconds, Fetched: 1 row(s)</span><br></span></code></pre></div></div>
<p>default 数据库中的 test 表存放在 <code>/user/hive/warehouse/test/</code> ，查看文件可以看到表的内容（列之间有不可见的分隔符）</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/apache-hive-3.1.3-bin/logs$ hdfs dfs -ls -r /user/hive/warehouse/test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found 1 items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup          8 2023-05-25 22:52 /user/hive/warehouse/test/000000_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wjf@node0:/server/apache-hive-3.1.3-bin/logs$ hdfs dfs -cat /user/hive/warehouse/test/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3jimM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4MaryF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>hiveserver2 是 Hive 内置的 ThriftServer 服务，提供 Thrift 端口供其他客户端连接，例如 Hive 内置的 beeline</p>
<p>启动 hiveserver2 ，JPS 中同样名称是 <code>RunJar</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nohup bin/hive --service hiveserver2 &gt;&gt; logs/hiveserver2.log 2&gt;&amp;1 &amp;</span><br></span></code></pre></div></div>
<p>使用 <code>bin/beeline</code> 启动 beeline ，使用 <code>!connect</code> 命令连接数据库</p>
<p>需要添加以下配置，不然 beeline 无法连接</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># hive-site.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;name&gt;hive.server2.enable.doAs&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;value&gt;true&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/property&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># hadoop core-site.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;name&gt;hadoop.proxyuser.myusergroup.groups&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;value&gt;*&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;property&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;name&gt;hadoop.proxyuser.myusername.hosts&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;value&gt;*&lt;/value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/property&gt;</span><br></span></code></pre></div></div>
<p>启动 beeline</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bin/beeline </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Class path contains multiple SLF4J bindings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/apache-hive-3.1.3-bin/lib/log4j-slf4j-impl-2.17.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/hadoop-3.3.5/share/hadoop/common/lib/slf4j-reload4j-1.7.36.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Class path contains multiple SLF4J bindings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/apache-hive-3.1.3-bin/lib/log4j-slf4j-impl-2.17.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Found binding in [jar:file:/server/hadoop-3.3.5/share/hadoop/common/lib/slf4j-reload4j-1.7.36.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Beeline version 3.1.3 by Apache Hive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beeline&gt; !connect jdbc:hive2://node0:10000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to jdbc:hive2://node0:10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter username for jdbc:hive2://node0:10000: wjf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password for jdbc:hive2://node0:10000: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected to: Apache Hive (version 3.1.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Driver: Hive JDBC (version 3.1.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; select * from test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Compiling command(queryId=wjf_20230529222057_b1e2de31-e06a-4447-9438-a7019fc98105): select * from test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Semantic Analysis Completed (retrial = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:test.id, type:int, comment:null), FieldSchema(name:test.name, type:string, comment:null), FieldSchema(name:test.gender, type:string, comment:null)], properties:null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Completed compiling command(queryId=wjf_20230529222057_b1e2de31-e06a-4447-9438-a7019fc98105); Time taken: 2.595 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Executing command(queryId=wjf_20230529222057_b1e2de31-e06a-4447-9438-a7019fc98105): select * from test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Completed executing command(queryId=wjf_20230529222057_b1e2de31-e06a-4447-9438-a7019fc98105); Time taken: 0.003 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+------------+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test.id  | test.name  | test.gender  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+------------+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 3        | jim        | M            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 4        | Mary       | F            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1        | John       | M            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 2        | sam        | M            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+------------+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 rows selected (3.112 seconds)</span><br></span></code></pre></div></div>
<p>beeline 使用起来较原生命令行客户端更美观。也可以使用图形化的 DataGrip 和 DBeaver 连接 Hive ，使用体验更好</p>
<p>创建数据库</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; create database mydatabase1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No rows affected (0.104 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; show databases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| database_name  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| default        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mydatabase1    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows selected (0.079 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; use mydatabase1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No rows affected (0.075 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; create table test(id int);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No rows affected (0.683 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; show tables;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| tab_name  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row selected (0.111 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0: jdbc:hive2://node0:10000&gt; desc test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| col_name  | data_type  | comment  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id        | int        |          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row selected (0.097 seconds)</span><br></span></code></pre></div></div>
<p>数据库操作命令</p>
<p>HIVE 库在 hdfs 上是一个名称以 <code>.db</code> 结尾的文件夹</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建数据库，默认路径 hdfs://ip:port/user/hive/warehouse/databasename.db </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create database [if not exists] db_name [location &#x27;/path/to/database&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除数据库，如果存在表需要加上 cascade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop database db_name [cascade];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 数据库详细信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">desc database db_name</span><br></span></code></pre></div></div>
<p>创建表</p>
<p>hive 包括 内部表，外部表，等。内部表默认位置 /user/hive/warehouse ，默认创建的是内部表，desc 显示 managed_table 。外部表创建需要加上 external 并加上 location （路径，文件夹级别），desc 显示 external_table。删除内部表会删除数据和元信息，是 hive 管理的表，持久使用。外部表只会删除元数据，数据会保留，用于临时链接外部数据，可以先有表也可以先有数据</p>
<p>创建表时可以自定义列分隔符，外部表通常自定义分隔符，与外部数据保持一致，默认分隔符 <code>^A</code> ，也就是 8 进制 <code>\001</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建内部表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table tb_name (col_name col_type ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建外部表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">craete external table tb_name (col_name col_type ...) row format delimited fields terminated by &#x27;\t&#x27; location ...</span><br></span></code></pre></div></div>
<p>导入数据创建一个外部表</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ hdfs dfs -cat /my/table/mytable.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1	jeff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2	john</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3	mary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4	tim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; create external table mytable (id int, name string) row format delimited fields terminated by &#x27;\t&#x27; location &#x27;/my/table&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; select * from mytable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mytable.id  | mytable.name  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1           | jeff          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 2           | john          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 3           | mary          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 4           | tim           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+---------------+</span><br></span></code></pre></div></div>
<p>内外部表转换</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alter table tb_name set tblproperties(&#x27;EXTERNAL&#x27;=&#x27;TRUE&#x27; | &#x27;FALSE&#x27;)</span><br></span></code></pre></div></div>
<p>加载数据</p>
<p>使用 LOAD DATA 命令加载，LOCAL 代表本地数据，不带 <code>LOCAL</code> 表示 HDFS 路径， <code>OVERWRITE</code> 覆盖已经存在的。如果基于 hdfs 加载数据，源文件会移动到表所在的目录，源文件会消失。也可以使用 <code>insert select</code> 命令导入数据，会走 mapreduce</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LOAD DATA [LOCAL] INPATH &#x27;filepath&#x27; [OVERWRITE] INTO TABLE tb_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">insert [into | overwrite] table tb1 select * from tb2</span><br></span></code></pre></div></div>
<p>导出数据命令类似。如果不定义分隔符，默认就是 <code>\001</code> 。如果不加 local 则导入到 hdfs</p>
<p>也可以使用 hive shell 导出 ， <code>-e</code> 表示执行 sql 语句，<code>-f</code> 表示执行 sql 文件，然后重定向</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">insert overwrite [local] directory &#x27;/my/dir&#x27; [row format delimited fields terminated by &#x27;\t&#x27;] select * from tb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin/hive -e “select * from db1.tb1;&quot; &gt; /path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin/hive -f export.sql &gt; /path</span><br></span></code></pre></div></div>
<p>Hive 也有分区表的概念，类似关系型数据库的分库分表，当数据量大的时候，可以使用分区表，分区表是通过文件夹实现的。查询数据的时候会额外带上分区列。分区可以多层级，插入的的时候要指定每一层。</p>
<p>使用 <code>partition</code> 创建分区表</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create table tb_name(...) paartitioned by (分区列 列类型, ...) row format delimited fields terminated by &#x27;\t&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load data local inpath &#x27;/path.txt&#x27; into table mydb.mytable partition(mounth=&#x27;202306&#x27;)</span><br></span></code></pre></div></div>
<p>插入数据，数据会带上分区列</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt;load data local inpath &#x27;/server/tmp/student.txt&#x27; into table mydb.student partition(month=&#x27;202306&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; select * from mydb.student;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+----------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| student.id  | student.score  | student.month  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+----------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| jeff        | 99             | 202306         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| merry       | 100            | 202306         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| john        | 89             | 202306         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| jim         | 93             | 202306         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+----------------+----------------+</span><br></span></code></pre></div></div>
<p>数据存放在 <code>/user/hive/warehouse/mydb.db/student/month=202306/student.txt</code></p>
<p>同样的，可以创建多分区列，插入时需要指定所有分区</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create table mydb.student2(id string, score int) partitioned by (year string, month string) row format delimited fields terminated by &#x27;\t&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load data local inpath &#x27;/server/tmp/student.txt&#x27; into table mydb.student2 partition(year=&#x27;2023&#x27;,month=&#x27;06&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 数据存放在 /user/hive/warehouse/mydb.db/student2/year=2023/month=06/student.txt</span><br></span></code></pre></div></div>
<p>分桶表</p>
<p>类似于分区表，不同于分区表将文件存放在不同文件夹中，分桶是将表拆分到固定数量的不同文件中</p>
<p>使用 <code>clustered by(col) into n buckets</code> 创建分桶表</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 自动匹配 reduce task 数量与桶数量一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set hive.enforce.bucketing=true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建分桶表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table student3(id string, score int) clustered by (id) into 3 buckets row format delimited fields terminated by &#x27;\t&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>分桶表无法通过 load data 加载数据，只能通过 insert select 。比较好的方式是创建临时表，通过 load data 加载到临时表，再通过 insert select 加载</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建临时表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table student3_tmp(id string, score int) row format delimited fields terminated by &#x27;\t&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 临时表加载数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load data local inpath &#x27;/server/tmp/student.txt&#x27; into table mydb.student3_tmp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 插入数据（小数据量特别慢）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">insert overwrite table mydb.student3 select * from mydb.student3_tmp cluster by(id);</span><br></span></code></pre></div></div>
<p>表被分为 3 分存储，数据按照 hash 分到不同文件</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ hdfs dfs -ls /user/hive/warehouse/mydb.db/student3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found 3 items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup         15 2023-06-07 22:52 /user/hive/warehouse/mydb.db/student3/000000_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup         10 2023-06-07 22:52 /user/hive/warehouse/mydb.db/student3/000001_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--   3 wjf supergroup         15 2023-06-07 22:52 /user/hive/warehouse/mydb.db/student3/000002_0</span><br></span></code></pre></div></div>
<p>分桶表可以提升效率，例如查询，通过 hash 计算，知道值在哪个桶里，就可以过滤掉很多无关的桶</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/note/tool/mongo"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mongo DB</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/note/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#安装-jdk8" class="table-of-contents__link toc-highlight">安装 jdk8</a></li><li><a href="#安装-hadoop" class="table-of-contents__link toc-highlight">安装 hadoop</a></li><li><a href="#配置" class="table-of-contents__link toc-highlight">配置</a></li><li><a href="#hdfs" class="table-of-contents__link toc-highlight">HDFS</a></li><li><a href="#mapreduce-和-yarn" class="table-of-contents__link toc-highlight">MapReduce 和 Yarn</a></li><li><a href="#hive" class="table-of-contents__link toc-highlight">Hive</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/note/algorithmPractice">Algorithm</a></li><li class="footer__item"><a class="footer__link-item" href="/note/designPattern">Design Pattern</a></li><li class="footer__item"><a class="footer__link-item" href="/note/docker">Docker</a></li><li class="footer__item"><a class="footer__link-item" href="/note/java">Java</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Jianfeng's Site. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>